# 要件定義書

## プロジェクト概要
- プロジェクト名: Business Flow
- 作成日: 2024年12月
- バージョン: 1.0

## 目的
業務フローを視覚的に作成・編集できるWebアプリケーションを開発する。ユーザーが直感的にフローチャートを作成し、業務プロセスの可視化と共有を可能にする。

## 機能要件

### 主要機能
1. フロー図作成機能
   - 詳細説明: グリッドベースのキャンバス上でフローチャートを作成
   - 入力: マウス操作、キーボード入力
   - 出力: 視覚的なフローチャート
   - 処理内容: ドラッグ&ドロップによる要素配置、テキスト編集、リアルタイムリサイズ

2. 要素管理機能
   - 詳細説明: カラーカード、矢印、分岐記号、システム機能カードなどの要素を管理
   - 入力: マウスクリック、ドラッグ操作
   - 出力: 配置されたフロー要素
   - 処理内容: 要素の追加、削除、移動、編集、ドラッグリサイズ

3. テキスト編集機能
   - 詳細説明: フロー要素内のテキストを編集可能
   - 入力: キーボード入力、ダブルクリック
   - 出力: 編集されたテキスト
   - 処理内容: インライン編集、プロパティパネル編集

4. システム機能カード
   - 詳細説明: 業務フローで使用するシステム機能を視覚的に表現
   - 入力: テンプレート選択
   - 出力: 3D風グラデーションカード（データベース、API、メール、通知、計算、バリデーション）
   - 処理内容: グラデーション描画、影効果、アイコン表示、光沢効果

### 副次機能
- フロー保存・読み込み機能（LocalStorage）
- フロー画像エクスポート機能（JSON形式）
- グリッド表示/非表示切り替え
- グリッドスナップ機能
- ズーム機能（0.3倍〜3倍）
- キャンバス動的拡張機能
- ドラッグによるリサイズ機能
- ダブルクリックによるインライン編集
- 矢印太さ調整機能（1〜20px）
- フロータイトル設定機能

## 非機能要件

### パフォーマンス要件
- レスポンス時間: 要素のドラッグ&ドロップ操作で100ms以内
- スループット: 同時に100個の要素を扱える
- 同時接続数: 1ユーザー（ローカルアプリケーション）

### セキュリティ要件
- 認証方式: 不要（ローカルアプリケーション）
- 認可方式: 不要
- データ暗号化: ローカルストレージでのデータ保存

### 可用性要件
- 稼働率: 99%（ローカルアプリケーション）
- 障害復旧時間: ブラウザリロードで即座に復旧

## システム構成

### アーキテクチャ
- フロントエンドのみのSPA（Single Page Application）
- クライアントサイドレンダリング
- ローカルストレージによるデータ永続化

### 技術スタック
- フロントエンド: HTML5, CSS3, JavaScript (ES6+)
- UIフレームワーク: Bootstrap 5
- データ管理: LocalStorage API
- グラフィック: HTML5 Canvas / SVG
- バックエンド: 不要
- データベース: 不要（LocalStorage使用）
- インフラ: 静的ファイルホスティング（GitHub Pages等）

## データ構造設計

### データモデル
- Flow: フロー全体の情報
- Element: フロー要素（カード、矢印、分岐記号）
- Connection: 要素間の接続情報

### データ形式
```javascript
// Flow構造
{
  id: string,
  name: string,
  elements: Element[],
  connections: Connection[],
  createdAt: Date,
  updatedAt: Date
}

// Element構造
{
  id: string,
  type: 'card' | 'arrow' | 'branch',
  x: number,
  y: number,
  width: number,
  height: number,
  text: string,
  color: string,
  style: object
}

// Connection構造
{
  id: string,
  fromElementId: string,
  toElementId: string,
  points: {x: number, y: number}[]
}
```

## 機能設計

### 画面構成
- メインキャンバス: フロー作成エリア
- ツールパレット: 要素選択エリア
- プロパティパネル: 選択要素の編集エリア
- メニューバー: ファイル操作、表示設定

### 操作フロー
1. ツールパレットから要素を選択
2. キャンバス上でクリックして要素を配置
3. 要素をドラッグして移動
4. 要素をクリックしてテキスト編集
5. 要素間をドラッグして接続線を作成

## UI/UX設計

### 画面構成
- メインページ: フロー作成画面
- ヘルプページ: 操作説明画面

### 画面遷移図
- メインページ → ヘルプページ（ヘルプボタンクリック）
- ヘルプページ → メインページ（戻るボタンクリック）

### デザインガイドライン
- カラーパレット: Bootstrap 5のデフォルトカラー + カスタムカラー
- フォント: Bootstrap デフォルトフォント（system-ui）
- レイアウト: レスポンシブデザイン、モバイル対応
- 要素カラー: 青、緑、赤、黄、紫の5色パレット

## 開発スケジュール

### マイルストーン
- Phase 1: 基本UI構築（2週間）
- Phase 2: フロー要素実装（3週間）
- Phase 3: ドラッグ&ドロップ機能（2週間）
- Phase 4: テキスト編集機能（1週間）
- Phase 5: 保存・読み込み機能（1週間）
- Phase 6: テスト・デバッグ（1週間）

### タスク分解
- HTML/CSS基本構造作成: 開発者, Phase 1
- Bootstrap統合: 開発者, Phase 1
- キャンバス実装: 開発者, Phase 2
- カラーカード要素実装: 開発者, Phase 2
- 矢印要素実装: 開発者, Phase 2
- 分岐記号要素実装: 開発者, Phase 2
- ドラッグ&ドロップ機能: 開発者, Phase 3
- グリッド表示機能: 開発者, Phase 3
- テキスト編集機能: 開発者, Phase 4
- LocalStorage保存機能: 開発者, Phase 5
- 画像エクスポート機能: 開発者, Phase 5
- テスト・デバッグ: 開発者, Phase 6

## リスク管理

### 技術的リスク
- ブラウザ互換性問題: 中, 主要ブラウザでのテスト実施
- パフォーマンス問題: 中, 要素数制限と最適化実装
- LocalStorage容量制限: 低, データ圧縮とクリーンアップ機能

### プロジェクトリスク
- 開発期間延長: 中, 機能優先度の再評価
- 要件変更: 低, アジャイル開発手法採用

## テスト計画

### テスト種別
- 単体テスト: JavaScript関数の動作確認
- 結合テスト: 要素間の相互作用確認
- システムテスト: 全体機能の動作確認
- 受け入れテスト: ユーザーシナリオテスト

### テストケース
- 要素の配置・移動テスト
- テキスト編集テスト
- 保存・読み込みテスト
- ブラウザ互換性テスト

## 運用・保守

### 監視項目
- ブラウザコンソールエラー監視
- パフォーマンス監視（要素数、レスポンス時間）
- LocalStorage使用量監視

### バックアップ・復旧
- 自動保存機能（定期的なLocalStorage更新）
- 手動エクスポート機能（JSON形式）
- ブラウザデータクリア時の復旧手順

## 付録

### 用語集
- フロー: 業務プロセスの流れを図式化したもの
- 要素: フローを構成する個々の部品（カード、矢印、分岐記号）
- キャンバス: フローを作成する作業エリア
- グリッド: 要素の配置を整列させるための格子状のガイド
- LocalStorage: ブラウザにデータを保存するWeb API

### 参考資料
- Bootstrap 5公式ドキュメント
- HTML5 Canvas API リファレンス
- JavaScript ES6+ 仕様書
